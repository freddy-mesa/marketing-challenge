AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'receeve-challenge-app

  '
Globals:
  Function:
    Timeout: 3
Resources:
  ReceeveChallengeFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: ReceeveChallengeFunction
      Handler: challenge/dist/app.lambdaHandler
      Runtime: nodejs14.x
      Environment:
        Variables:
          AWS_REGION: us-east-1
          AWS_SECRET_ACCESS_KEY: '123'
          AWS_ACCESS_KEY_ID: '123'
          SNS_ARN_TOPIC_NAME: arn:aws:sns:us-east-1:000000000000:receeve-challenge-topic
          DYNAMO_TABLE_NAME: receeve-challenge-table
          MAILGUN_SIGNING_KEY: f6ecbdb7d9a52758b64e3c02611a4041-2bf328a5-751b3744
      Events:
        ReceeveChallenge:
          Type: Api
          Properties:
            Path: /receeve-challenge
            Method: post
  ReceeveChallengeTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: receeve-challenge-table
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      ProvisionedThroughput:
        ReadCapacityUnits: 2
        WriteCapacityUnits: 2
  ReceeveChallengeTopic:
    Type: AWS::SNS::Topic
    Properties:
      TopicName: receeve-challenge-topic
Outputs:
  ReceeveChallengeApi:
    Description: API Gateway endpoint URL for Prod stage for Receeve Challenge function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/dev/receeve-challenge/
  ReceeveChallengeFunction:
    Description: Receeve Challenge Lambda Function ARN
    Value:
      Fn::GetAtt:
      - ReceeveChallengeFunction
      - Arn
  ReceeveChallengeFunctionIamRole:
    Description: Implicit IAM Role created for Receeve Challenge function
    Value:
      Fn::GetAtt:
      - ReceeveChallengeFunctionRole
      - Arn
